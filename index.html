<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Your Learning Curve - Star Trail</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }
        .container {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            margin: 20px;
            max-width: 800px;
            width: 100%;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        p {
            text-align: center;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        #gameContainer {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        #gameArea, #trackpad {
            width: 300px;
            height: 300px;
            border: 2px solid #3498db;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
        }
        #gameArea {
            background: linear-gradient(45deg, #f1f2f6, #e3e5e8);
        }
        #trackpad {
            background: linear-gradient(45deg, #e3e5e8, #d1d3d7);
            cursor: crosshair;
        }
        #cursor {
            width: 6px;
            height: 6px;
            background-color: #3498db;
            border-radius: 50%;
            position: absolute;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
        }
        #trail, #cursorPath {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #score {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin: 10px 0;
        }
        #results {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .chart-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mind Your Learning Curve - Star Trail</h1>
        <p>Use the trackpad on the right to move the blue cursor between the red star trails. The cursor moves opposite to your input. Start at the arrow and complete the star 5 times!</p>
        <div id="gameContainer">
            <div id="gameArea">
                <canvas id="trail"></canvas>
                <canvas id="cursorPath"></canvas>
                <div id="cursor"></div>
            </div>
            <div id="trackpad"></div>
        </div>
        <p id="score">Star: 1/5</p>
        <div id="results" style="display: none;">
            <h2>Your Learning Curves</h2>
            <div class="chart-container">
                <canvas id="timeChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="mistakesChart"></canvas>
            </div>
            <p>The graphs show the time taken (in seconds) and the number of mistakes for each star path. A decreasing trend indicates improvement.</p>
            <button class="btn" onclick="location.reload()">Play Again</button>
        </div>
    </div>

    <script>
    // JavaScript code will be in the next part
    </script>
</body>
</html>

<script>
    const gameArea = document.getElementById('gameArea');
    const trackpad = document.getElementById('trackpad');
    const cursor = document.getElementById('cursor');
    const trail = document.getElementById('trail');
    const cursorPath = document.getElementById('cursorPath');
    const ctx = trail.getContext('2d');
    const pathCtx = cursorPath.getContext('2d');
    const scoreDisplay = document.getElementById('score');
    const results = document.getElementById('results');

    let starCount = 1;
    let startTime;
    let times = [];
    let mistakes = [];
    let currentMistakes = 0;
    let starPoints = [];
    let lastX, lastY;
    let startX, startY;
    let outerRadius, innerRadius;
    let isFirstMove = true;
    let lastTrackpadX, lastTrackpadY;
    let hasStartedRound = false;
    let hasCompletedLoop = false;
    let centerX, centerY;
    let isOutside = false;

    trail.width = gameArea.offsetWidth;
    trail.height = gameArea.offsetHeight;
    cursorPath.width = gameArea.offsetWidth;
    cursorPath.height = gameArea.offsetHeight;

    function generateStarTrail() {
        centerX = trail.width / 2;
        centerY = trail.height / 2;
        outerRadius = 140;
        innerRadius = 80;
        starPoints = [];

        ctx.clearRect(0, 0, trail.width, trail.height);
        pathCtx.clearRect(0, 0, cursorPath.width, cursorPath.height);
        
        drawStar(centerX, centerY, 5, outerRadius, outerRadius * 0.38);
        drawStar(centerX, centerY, 5, innerRadius, innerRadius * 0.38);

        for (let i = 0; i < 10; i++) {
            const angle = (Math.PI * 2 * i) / 10 - Math.PI / 2;
            const radius = (outerRadius + innerRadius) / 2;
            const x = centerX + radius * Math.cos(angle);
            const y = centerY + radius * Math.sin(angle);
            starPoints.push({x, y});
        }

        startX = centerX;
        startY = centerY - (outerRadius + innerRadius) / 2;
        drawArrow(startX, startY - 20, startX, startY);

        if (!hasStartedRound) {
            setCursorPosition(startX, startY);
            lastX = startX;
            lastY = startY;
        }

        pathCtx.beginPath();
        pathCtx.moveTo(lastX, lastY);

        isFirstMove = true;
        hasCompletedLoop = false;
    }

    function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
        let rot = Math.PI / 2 * 3;
        let x = cx;
        let y = cy;
        let step = Math.PI / spikes;

        ctx.beginPath();
        ctx.moveTo(cx, cy - outerRadius);
        for (let i = 0; i < spikes; i++) {
            x = cx + Math.cos(rot) * outerRadius;
            y = cy + Math.sin(rot) * outerRadius;
            ctx.lineTo(x, y);
            rot += step;

            x = cx + Math.cos(rot) * innerRadius;
            y = cy + Math.sin(rot) * innerRadius;
            ctx.lineTo(x, y);
            rot += step;
        }
        ctx.lineTo(cx, cy - outerRadius);
        ctx.closePath();
        ctx.strokeStyle = '#e74c3c';
        ctx.lineWidth = 2;
        ctx.stroke();
    }

    function drawArrow(fromX, fromY, toX, toY) {
        const headLength = 10;
        const angle = Math.atan2(toY - fromY, toX - fromX);

        ctx.beginPath();
        ctx.moveTo(fromX, fromY);
        ctx.lineTo(toX, toY);
        ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6));
        ctx.moveTo(toX, toY);
        ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6));
        ctx.strokeStyle = '#2ecc71';
        ctx.lineWidth = 3;
        ctx.stroke();
    }

    function setCursorPosition(x, y) {
        cursor.style.left = `${x - 3}px`;
        cursor.style.top = `${y - 3}px`;
    }

    function startStar() {
        generateStarTrail();
        if (!hasStartedRound) {
            startTime = Date.now();
            hasStartedRound = true;
        }
    }

    function endStar() {
        const endTime = Date.now();
        times.push((endTime - startTime) / 1000);
        mistakes.push(currentMistakes);
        starCount++;
        if (starCount <= 5) {
            scoreDisplay.textContent = `Star: ${starCount}/5`;
            hasStartedRound = false;
            currentMistakes = 0;
            startStar();
        } else {
            endGame();
        }
    }

    function endGame() {
        document.getElementById('gameContainer').style.display = 'none';
        scoreDisplay.style.display = 'none';
        results.style.display = 'flex';
        drawLearningCurves();
    }

    function drawLearningCurves() {
        drawTimeChart();
        drawMistakesChart();
    }

    function drawTimeChart() {
        const ctx = document.getElementById('timeChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1', '2', '3', '4', '5'],
                datasets: [{
                    label: 'Time to complete (seconds)',
                    data: times,
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Time (seconds)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Star Number'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Time to Complete Each Star Path'
                    }
                }
            }
        });
    }

    function drawMistakesChart() {
        const ctx = document.getElementById('mistakesChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1', '2', '3', '4', '5'],
                datasets: [{
                    label: 'Number of mistakes',
                    data: mistakes,
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.2)',
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of mistakes'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Star Number'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Mistakes Made in Each Star Path'
                    }
                }
            }
        });
    }

    function moveCursor(e) {
        const rect = trackpad.getBoundingClientRect();
        const trackpadX = (e.clientX || e.touches[0].clientX) - rect.left;
        const trackpadY = (e.clientY || e.touches[0].clientY) - rect.top;
        
        if (isFirstMove) {
            lastTrackpadX = trackpadX;
            lastTrackpadY = trackpadY;
            isFirstMove = false;
            return;
        }

        const deltaX = trackpadX - lastTrackpadX;
        const deltaY = trackpadY - lastTrackpadY;

        lastTrackpadX = trackpadX;
        lastTrackpadY = trackpadY;

        const scaleFactor = 1;
        const cursorX = lastX - deltaX * scaleFactor;
        const cursorY = lastY - deltaY * scaleFactor;
        
        const clampedX = Math.max(0, Math.min(cursorX, gameArea.offsetWidth - 6));
        const clampedY = Math.max(0, Math.min(cursorY, gameArea.offsetHeight - 6));
        
        setCursorPosition(clampedX, clampedY);

        pathCtx.beginPath();
        pathCtx.moveTo(lastX, lastY);
        pathCtx.lineTo(clampedX, clampedY);
        pathCtx.strokeStyle = 'rgba(52, 152, 219, 0.5)';
        pathCtx.lineWidth = 2;
        pathCtx.stroke();

        lastX = clampedX;
        lastY = clampedY;

        checkStarProgress(clampedX, clampedY);
    }

    function checkStarProgress(x, y) {
        const distanceFromCenter = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));

        if (distanceFromCenter >= innerRadius && distanceFromCenter <= outerRadius) {
            if (isOutside) {
                isOutside = false;
            }
            const distanceFromStart = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
            if (distanceFromStart > 50) {
                hasCompletedLoop = true;
            }
            if (hasCompletedLoop && distanceFromStart < 10) {
                endStar();
            }
        } else {
            if (!isOutside) {
                isOutside = true;
                currentMistakes++;
            }
        }
    }

    // Mouse events
    trackpad.addEventListener('mousedown', (e) => {
        isFirstMove = true;
        moveCursor(e);
    });
    trackpad.addEventListener('mousemove', (e) => {
        if (e.buttons > 0) {
            moveCursor(e);
        }
    });

    // Touch events
    trackpad.addEventListener('touchstart', (e) => {
        e.preventDefault();
        isFirstMove = true;
        moveCursor(e.touches[0]);
    });
    trackpad.addEventListener('touchmove', (e) => {
        e.preventDefault();
        moveCursor(e.touches[0]);
    });

    startStar();
</script>
